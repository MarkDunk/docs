<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="University of Waterloo Aerial Robotics Group">
        <link rel="canonical" href="http://www.docs.uwarg.com/picpilot/introduction/">
        <link rel="shortcut icon" href="../../../../favicon.ico">
        

	<title>Introduction - WARG Docs</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../..">WARG Docs</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Groundstation <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../groundstation/">Table of Contents</a>
</li>

                        
                            
<li >
    <a href="../../groundstation/introduction/">Introduction</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">PicPilot <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../">Table of Contents</a>
</li>

                        
                            
<li class="active">
    <a href="./">Introduction</a>
</li>

                        
                            
<li >
    <a href="../pid-loops/">PID Loops</a>
</li>

                        
                            
<li >
    <a href="../pwm-io/">PWM and IO</a>
</li>

                        
                            
<li >
    <a href="../uart/">UART</a>
</li>

                        
                            
<li >
    <a href="../spi/">SPI</a>
</li>

                        
                            
<li >
    <a href="../direct-memory-access/">Direct Memory Access</a>
</li>

                        
                            
<li >
    <a href="../i2c/">I2C</a>
</li>

                        
                            
<li >
    <a href="../datalink/">Datalink</a>
</li>

                        
                            
<li >
    <a href="../analog-to-digital-converter/">Analog to Digital Converter</a>
</li>

                        
                            
<li >
    <a href="../sensors-and-peripherals/">Sensors and Peripherals</a>
</li>

                        
                            
<li >
    <a href="../attitude-control/">Attitude Control</a>
</li>

                        
                            
<li >
    <a href="../path-management/">Path Management</a>
</li>

                        
                            
<li >
    <a href="../resources/">Resources</a>
</li>

                        
                            
<li >
    <a href="../faq/">FAQ</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../../computervision/">Computer Vision</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Bootcamps <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../bootcamp/mechanical/">Mechanical</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorials <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../tutorials/git/">Git and Github</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../pid-loops/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
                    <li>
                        <a href="https://github.com/UWARG/WARG-Docs">
                            
                                <i class="fa fa-github"></i>
                            
                            GitHub
                        </a>
                    </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#introduction">Introduction</a></li>
        
            <li><a href="#setup">Setup</a></li>
        
            <li><a href="#github-setup">Github Setup</a></li>
        
            <li><a href="#mplab-setup">MPLAB Setup</a></li>
        
            <li><a href="#github-usage">GitHub Usage</a></li>
        
            <li><a href="#c-programming-language">C (Programming Language)</a></li>
        
            <li><a href="#programming-the-device">Programming the Device</a></li>
        
            <li><a href="#autopilot-system-overview">Autopilot System Overview</a></li>
        
            <li><a href="#schematics-and-board-design">Schematics and Board Design</a></li>
        
            <li><a href="#project-files">Project files</a></li>
        
            <li><a href="#coding-convention">Coding Convention</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="introduction">Introduction</h1>
<p>The PICpilot is a software package meant to control fixed-wing aircraft and numerous "copters", among other vehicles. It requires the usage of a specific type of digital signal microcontroller. This microcontroller is produced by <a href="http://www.microchip.com">Microchip</a>. The microcontroller that is currently supported is the <a href="http://www.microchip.com/wwwproducts/Devices.aspx?product=dsPIC33FJ256GP710A">dspic33fj256gp710A</a>. However, many other similar models can be easily adapted for support.</p>
<p>This software is designed to be used with two communicating microcontrollers (essential double cores). Due to the atypical nature of the software, it is recommended to view the board schematics <a href="https://drive.google.com/file/d/0BySpWXvmBM4JTTBIQmR0bXVOd1k/edit?usp=sharing">here</a>. The schematics are also included in another section of this document.</p>
<p>The two processors are allocated to two individual tasks. The chip which is responsible for attitude management is often referred to as the "main" chip. It is responsible for making corrections to the planes orientation in space, which involves pitch, roll, yaw, heading, throttle, and altitude. It also manages a few additional tasks involving relaying communication with the ground station. The second processor is often referred to as the "Path Manager". This chip controls the where the plane should fly (path), and the transitions in altitude and heading between each waypoint (specific GPS coordinates). It also controls the GPS and altitude sensors. These two chips work asynchronously from one another in order to automate the plane.</p>
<h2 id="setup">Setup</h2>
<p>To get started, you will need three things:
<em> A Git Client - https://github.com/
</em> MPLAB XC16 Compiler (16-bit) - http://www.microchip.com/pagehandler/en-us/family/mplabx/home.html?tab=t2#tab-2
* (Optional) MPLAB X IDE - http://www.microchip.com/pagehandler/en-us/family/mplabx/home.html?tab=t2#tab-2</p>
<h2 id="github-setup">Github Setup</h2>
<p>A similar powerpoint presentation can be found here:<a href="https://docs.google.com/presentation/d/1HkjCdRQyY1LFaUO-24SxHGLx4cgeq_Z5OWQQNKFfidM/edit?usp=sharing">https://docs.google.com/presentation/d/1HkjCdRQyY1LFaUO-24SxHGLx4cgeq_Z5OWQQNKFfidM/edit?usp=sharing</a></p>
<p>If you are not using the GUI skip this section.</p>
<ol>
<li>Setup a <a href="https://github.com">Github</a> Account</li>
<li>Select "Set up Git"</li>
<li>Select "Download GitHub for <Your Operating System>"</li>
<li>Select "Run" and continue through the installation process</li>
<li>Once the installation is complete, launch the application.</li>
<li>Log in</li>
<li>Find the Git Bash shell and type in the following commands:<br />
<code>git config global user.name "YOUR USERNAME HERE"</code><br />
<code>git config global user.email "YOUR EMAIL HERE"</code><br />
These set the default name and email you use when committing to GitHub.</li>
<li>At this point you will need to let one of the WARG team leads know your username, so that you can be added to the repository member's list.</li>
<li>You should then be able to clone the project using the clone button, or the project URL.  </li>
</ol>
<p>You should now have the code. </p>
<h2 id="mplab-setup">MPLAB Setup</h2>
<p>You now need the libraries and compilers, as well as the optional MPLAB X IDE, in order to develop code.</p>
<h3 id="compiler">Compiler</h3>
<ol>
<li>Download the <a href="http://www.microchip.com/pagehandler/en-us/family/mplabx/home.html?tab=t2#tab-2">compiler</a>. You want the MPLAB XC16 Compiler V1.21 or newer. Unzip the file once it is completed.</li>
<li>Accept the license agreement.</li>
<li>Select "Install Compiler".</li>
<li>Select "Install MPLAB XC16 C Compiler on this computer.</li>
<li>Leave the activation key blank. Confirm "Yes" when the dialog prompts you about using the free version.</li>
<li>Select "Run the compiler in free mode".</li>
<li>Select the installation directory.</li>
<li>
<p>Run and finish the installation.</p>
</li>
<li>
<p>Note whenever you make a new project, make sure the right compiler is selected, otherwise there will be a lot of indicated syntax errors (red underlines).</p>
</li>
</ol>
<h3 id="ide-the-fancy-word-editor-that-lets-you-do-some-code-shenanigans">IDE (The fancy word editor that lets you do some code-shenanigans)</h3>
<ol>
<li>Download the <a href="http://www.microchip.com/pagehandler/en-us/family/mplabx/home.html?tab=t2#tab-2">IDE Package</a>. You want the MPLAB X IDE V2.10 or newer. Unzip the file once it is completed.</li>
<li>Proceed through the installation process (select installation directory, accept license agreement).</li>
</ol>
<h2 id="github-usage">GitHub Usage</h2>
<p>If you don't know how to use Git or you need a reference, <a href="http://gitimmersion.com/">GitImmersion</a> is a great website.</p>
<h4 id="gui-usage">GUI Usage:</h4>
<ul>
<li>Make sure you have correctly set your default storage location in the Options menu.  </li>
</ul>
<p><strong>Saving Files (Committing and Pushing)</strong>  </p>
<ol>
<li>Select your Project</li>
<li>Select the files that are supposed to be committed.</li>
<li>Write a commit message, that gives a general overview about each change completed in this update.</li>
<li>Hit "Commit".</li>
<li>Once you are ready to sync the changes, hit the sync button (top of the window).</li>
</ol>
<p><strong>Reading Files from the Server (Pulling)</strong>
* Simply click the sync button at top of the window.</p>
<h4 id="general-syntax-git-bash">General Syntax (Git Bash):</h4>
<ul>
<li><code>git add &lt;Filename&gt; or git add .</code> stages the file for commit.</li>
<li><code>git status</code> displays all changes being made.</li>
<li><code>git commit -m "&lt;Commit message here&gt;"</code> makes the change.</li>
<li><code>git push</code> sends the change to the server</li>
<li><code>git pull</code> retrieves the latest change from the server.</li>
<li><code>git checkout &lt;HASH&gt;</code> retrieves a SPECIFIC version from the server.</li>
<li><code>git checkout -b &lt;Branch Name&gt;</code> creates a new branch.</li>
<li><code>git merge master</code> merges the current branch with the latest code.</li>
</ul>
<h4 id="general-concepts">General Concepts:</h4>
<ul>
<li>When making small changes it is okay to commit to the master branch.</li>
<li>When making large changes (that take multiple days to complete), always make a branch, so that others can work concurrently without compiling broken code.</li>
<li>Always build your code before committing (To make sure it isn't broken).</li>
<li>Try and get rid of warnings if possible.</li>
</ul>
<h2 id="c-programming-language">C (Programming Language)</h2>
<p>The language being used in this project is C. If you are familiar with C++, the concepts are very similar. C is a low level programming language. This means that it does not have a large amount of "built-in" functionality, therefore learning C is quite straight forward.</p>
<p>The compiler used for this project is listed above. It is a modified version of the GCC Compiler.</p>
<p>A set of well maintained tutorials can be found here: <a href="http://www.cprogramming.com/tutorial/c/lesson1.html">http://www.cprogramming.com/tutorial/c/lesson1.html</a></p>
<p>Topics that one should be familiar with include (in order of importance):</p>
<ul>
<li>If statements</li>
<li>Looping</li>
<li>Functions</li>
<li>Variable types and how they work</li>
<li>Arrays</li>
<li>Pointers</li>
<li>Structures, Unions</li>
</ul>
<p>Unrelated topics:</p>
<ul>
<li>Printf (There is no GUI)</li>
<li>File I/O (All I/O operations are specific to the chip)</li>
</ul>
<p>Knowledge of common data structures (binary trees, linked lists, etc.) is beneficial, but not mandatory.</p>
<h2 id="programming-the-device">Programming the Device</h2>
<p>In order to program the device, you must have setup your account according to the Setup section. You should also refer to the Schematics and Board Design section for the ports required to complete the programming process. You will require an ICD 3 or a similar programming device.</p>
<p>When using the MPLAB X GUI the process to program the device is as follows:</p>
<p>-
  1. Ensure the project you wish to program is the main project.
  2. Connect a cable to the programming port. The pins that should be part of the programming port are MCLR, PGD1, and PGC1.
  3. Click the "Make and Program Device" button in the top toolbar. Optionally, you can also press the debug button to use the debugging features of MPLAB X.</p>
<p>When using your own editor and compiling from the command line:</p>
<p>-
  1. Have the binary file ready for programming.
  2. Connect a cable to the programming port. The pins that should be part of the programming port are MCLR, PGD1, and PGC1.
  3. Open the MPLAB IPE interface.
  4. Select your chip model.
  5. For the source option, browse to your binary file.
  6. Press program and wait. Then optionally also use the verify option (recommended).</p>
<p>If you are using both chips of the PICpilot, ensure you correctly set the chip identifier pre-compiler in the main.h file, and ensure you program both chips.</p>
<h2 id="autopilot-system-overview">Autopilot System Overview</h2>
<p>The autopilot system is meant to be adaptable to any aircraft including fixed-wing and multi-rotor aircraft (still WIP). This document mostly covers the software design of the system, although there are a few hardware notes made in this section and the next.</p>
<p>First of all, the flowchart block diagram of the system is presented below:</p>
<p><img alt="Flowchart" src="http://i.imgur.com/8bODaoJ.png" /></p>
<p>From this diagram you can see how the software combined with the hardware interacts to provide the final resulting UAV behaviour.</p>
<p>There are three chips. The main one is most commonly referred to as the attitude manager. It is also the communication manager, and the Master chip for all interchip communication. The other chip is referred to as the path manager. The third one has the dedicated task of managing the mechanical "safety" relays which ensure that a safety pilot can always regain control of the aircraft.</p>
<p>There are four sensors used in the original design of the aircraft. A GPS (Global Positioning System), IMU (Inertial Measurement Unit), Altimeter, and a camera are all part of the system. Additionally, 2 wireless interfaces are included in the design. A wireless Xbee transmitter/receiver provides telemetry data, whereas an additional (Ultra-high frequency [UHF]) receiver is used to attain control from a standard RC controller.</p>
<p>The outputs from the system include pictures and potentially video, telemetry data, and a functioning aircraft (with moving flaps, elevators, rudder, and ailerons).</p>
<p>This document only covers the PICpilot, however a system overview of a previously fully assembled system will be described in this section. In the past, the PICpilot has been expanded into a larger and more sophisticated system as seen below.</p>
<p><img alt="Sample Autopilot System Integration" src="http://i.imgur.com/GnhOY3N.png" /></p>
<h2 id="schematics-and-board-design">Schematics and Board Design</h2>
<p>The following schematic was last used at the time of the writing this document. The following schematic was last updated in 2011. You can check out the board schematics <a href="https://drive.google.com/file/d/0BySpWXvmBM4JTTBIQmR0bXVOd1k/edit?usp=sharing">here</a>. They may also be available within the Github repository. You will require <a href="http://diptrace.com/download-diptrace/">Diptrace</a> in order to view the files. You can use the free version or use WARG's "Pro" license.</p>
<p><img alt="Board Schematic" src="http://i.imgur.com/V1Oe8YG.png" /></p>
<p>This board has 2 dspic33fj256710a chips. This is the PCB for the board. This is the labelled version:</p>
<p><img alt="Board Schematic Labelled" src="http://i.imgur.com/nEdhiwz.png" /></p>
<ol>
<li>
<p>Microcontroller 1 - Attitude/Communication Manager</p>
</li>
<li>
<p>Microcontroller 2 - Path Manager</p>
</li>
<li>
<p>Input PWM</p>
</li>
<li>
<p>Output PWM</p>
</li>
<li>
<p>Output PWM Safety Relay</p>
</li>
<li>
<p>Output PWM Safety Relay Microcontroller</p>
</li>
<li>
<p>Output PWM Safety Relay Microcontroller Programming Port</p>
</li>
<li>
<p>Microcontroller 2 Programming Port</p>
</li>
<li>
<p>SPI2 Port - VectorNav-100</p>
</li>
<li>
<p>SPI2 Ports - GPS</p>
</li>
<li>
<p>Switching Power Supply 1</p>
</li>
<li>
<p>Switching Power Supply 2</p>
</li>
<li>
<p>Voltage Regulator</p>
</li>
<li>
<p>SPI2 Port - Used as a power source for the altimeter</p>
</li>
<li>
<p>UART1 Port - Debug</p>
</li>
<li>
<p>UART2 Port - Wireless Transmitter (Xbee)</p>
</li>
<li>
<p>SPI2 Port - Altimeter</p>
</li>
<li>
<p>UART1 Port - Debug</p>
</li>
<li>
<p>UART2 Port - Unused</p>
</li>
<li>
<p>Microcontroller 2 Programming Port</p>
</li>
<li>
<p>PWM input/output - Sonar</p>
</li>
</ol>
<p>The important pins are listed below:</p>
<p><img alt="Board Pinout" src="http://i.imgur.com/UFKNtO2.png" /></p>
<p>The schematics for the board are below:</p>
<p><img alt="Attitude Manager" src="http://i.imgur.com/TYwSp8G.png" />
<img alt="Path Manager" src="http://i.imgur.com/MY3hXzZ.png" />
<img alt="Ports" src="http://i.imgur.com/9sDYtfG.png" />
<img alt="Other Power Stuff" src="http://i.imgur.com/J1iwVBz.png" /></p>
<h2 id="project-files">Project files</h2>
<p>All the project files are hosted on Github. However, for convenience they are listed below (accurate at the time of writing of this document):</p>
<ul>
<li>AttitudeManager.c</li>
<li>AttitudeManager.h</li>
<li>cameraManager.c</li>
<li>cameraManager.h</li>
<li>Clock.c</li>
<li>Clock.h</li>
<li>commands.h</li>
<li>debug.c</li>
<li>debug.h</li>
<li>delay.c</li>
<li>delay.h</li>
<li>fmath.c</li>
<li>fmath.h</li>
<li>FullInitialize.c</li>
<li>FullInitialize.h</li>
<li>I2C.c</li>
<li>I2C.h</li>
<li>InputCapture.c</li>
<li>InputCapture.h</li>
<li>InterchipDMA.c</li>
<li>InterchipDMA.h</li>
<li>lcd.h</li>
<li>main.c</li>
<li>main.h</li>
<li>MPL3115A2.c</li>
<li>MPL3115A2.h</li>
<li>net.h</li>
<li>net_common.c</li>
<li>net_inbound.c</li>
<li>net_outbound.c</li>
<li>OrientationControl.c</li>
<li>OrientationControl.h</li>
<li>OutputCompare.c</li>
<li>OutputCompare.h</li>
<li>PathManager.h</li>
<li>PathManager.c</li>
<li>PWM.c</li>
<li>PWM.h</li>
<li>SPI.c</li>
<li>StartupErrorCodes.c</li>
<li>StartupErrorCodes.h</li>
<li>StringUtils.c</li>
<li>StringUtils.h</li>
<li>UART1.c</li>
<li>UART1.h</li>
<li>UART2.c</li>
<li>UART2.h</li>
<li>VN_lib.c</li>
<li>VN_lib.h</li>
<li>VN_math.c</li>
<li>VN_math.h</li>
<li>VN_type.h</li>
<li>VN_user.c</li>
<li>VN_user.h</li>
<li>VN100.c</li>
<li>VN100.h</li>
<li>voltageSensor.c</li>
<li>voltageSensor.h</li>
</ul>
<h2 id="coding-convention">Coding Convention</h2>
<p>The coding convention form this project follows the standard coding convention for the C language.</p>
<p>The rule-set for the coding format is not extremely specific. However, there are a few rules of thumb to be aware of. The rules of thumb are:</p>
<ol>
<li><a href="http://en.wikipedia.org/wiki/Naming_convention_(programming)">Naming convention</a> - Use <a href="http://en.wikipedia.org/wiki/CamelCase">camelCase</a> notation for variables. Use capitals and <em>under_score_case</em> for constants.</li>
<li><a href="http://en.wikipedia.org/wiki/Indent_style">Indentation Style</a> - Use tabs/indents to show the program structure.</li>
<li>Commenting - Be thorough with comments. Include a header at the beginning of every file describing the file, the author, the file name, and the date of creation. For headers, include comments describing any constants, and for each function prototype include the function name, function inputs and outputs, and a description of its functionality.</li>
<li><strong>Never hard-code values</strong>. Any constants should be defined together so that they can be easily changed through iterations of the code.</li>
</ol></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
                <p>Copyright <a href="http://www.uwarg.com"> University of Waterloo Aerial Robotics Group</a></p>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
